<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.fenglei.mapper.system.SysRoleMenuMapper">

    <!-- 查询用户的所有菜单 -->
    <select id="listMenuByUserId" resultType="com.fenglei.model.system.entity.SysMenu"
            parameterType="java.lang.String">
         SELECT
            DISTINCT m.id AS id,
            m.name,
            m.parent_id,
            m.path,
            m.component,
            m.redirect,
            m.icon,
            m.sort
        FROM
            sys_user_role ur
        LEFT JOIN
            sys_role_menu rm ON ur.role_id = rm.role_id LEFT JOIN sys_menu m ON m.`id` = rm.`menu_id`
        WHERE
            ur.user_id = #{userId} and m.visible = 1 order by m.sort
    </select>

    <select id="selectRoleIdByUserId" resultType="integer">
        SELECT
            COUNT(*)
        FROM
            sys_role
        WHERE
                1 IN (
                SELECT
                    role_id
                FROM
                    sys_user_role
                WHERE
                    user_id = #{userId}
            )
    </select>
</mapper>
